# 测试用例

## 用例 1：产品经理 → 开发工程师

**输入（产品视角）：**
```
希望用户可以通过手机号一键登录，提升注册转化率。目前很多用户在注册页面流失，我们需要简化这个流程。
```
**结果：**

## 🚀 需求技术同步
实现基于运营商（移动/联通/电信）本机号码的一键认证功能，替代传统短信验证码，通过简化登录流程，技术核心在于安全、高效地集成运营商网关，以提升用户注册转化率。

## 💬 给开发发的群消息
---
@开发
关于"**手机号一键登录**"需求，核心逻辑如下：
1.  **意图**：集成三大运营商（移动/联通/电信）的本机号码认证服务，用户授权后，应用自动获取本机号码并完成登录/注册，无需手动输入验证码。
2.  **关键逻辑**：前端唤起运营商认证SDK -> 用户授权 -> 后端通过运营商网关换取手机号 -> 后端校验用户并创建/登录账户 -> 返回登录态。
3.  **技术关注点**：运营商网关接口的稳定性与安全调用、用户手机号与现有账户体系的匹配逻辑、认证失败后的降级方案（如回退短信验证码）。
4.  **验收标准**：
    *   功能：成功集成三家运营商SDK，用户可正常完成一键登录流程。
    *   性能：登录接口（含运营商网关调用）P99响应时间 < 2秒，支持QPS 100-1000。
    *   安全：传输过程加密，手机号等敏感信息脱敏存储，符合隐私合规要求。
    *   异常：网络超时、授权失败等场景有明确用户提示，并支持有限次重试。
---

## 🛠 技术视角解构
- **数据/埋点**：
    *   **关键事件**：`login_attempt`（登录尝试，触发一键登录）、`login_success`（登录成功）、`login_fail`（登录失败，需包含`fail_reason`，如：`operator_timeout`, `user_denied`）。
    *   **关键字段**：`login_type: one_click`、`operator: cmcc/cucc/ctcc`、`duration`（登录流程耗时）。
    *   **上报时机**：各事件在对应操作完成后立即上报。

- **逻辑边界**：
    *   **异常处理**：
        *   **运营商网关超时/失败**：设置超时时间（如3秒），失败后自动重试一次（仅限网络类错误）。若仍失败，可考虑前端降级展示"短信验证码登录"入口。
        *   **用户授权拒绝**：引导用户手动输入手机号或使用其他登录方式。
        *   **手机号与账户不匹配**：若系统根据手机号查找到多个账户或账户状态异常（如冻结），应中断自动登录，引导用户联系客服或使用密码登录。
        *   **频次与防刷**：对同一设备或IP的频繁登录失败请求进行限流（如1分钟5次）。
    *   **逆向流程**：用户在一键登录成功页，应提供"这不是我的手机号"或"切换账号"的退出入口，清除本次登录态，返回至登录方式选择页。

- **非功能性**：
    *   **性能**：针对QPS 100-1000的中等并发场景，后端调用运营商网关接口需考虑连接池、异步处理或结果缓存（运营商token有效期通常很短，约2分钟，缓存需谨慎）。
    *   **安全**：
        *   与运营商通信必须使用HTTPS。
        *   后端换取的手机号需进行脱敏处理后再写入业务日志。
        *   严格校验运营商返回的签名，防止伪造请求。
    *   **可用性**：因依赖外部运营商服务，需定义SLA（如99.5%），并设置监控告警（如接口成功率、平均耗时）。

- **技术方案建议**：
    *   **架构**：建议在后端设计一个统一的"认证网关"或"认证服务"，封装对三家运营商接口的差异，对外提供一致的`verifyToken(operator, clientToken)`方法。这有利于后续维护和增加其他认证方式。
    *   **选型**：前端集成各运营商官方SDK；后端语言根据现有技术栈选择（如Java/Go），需内置HTTP客户端、配置管理。

## ⏳ 粗估建议
- **复杂度**：**中等**
- **基准人天**：**8-12人天**。注：基于需同时集成三家运营商（联调复杂度较高）、设计统一的认证服务层、并完成完整的异常处理与降级逻辑的假设。若仅集成一家或复用现有简单验证码逻辑改造，复杂度可降低。

## 用例 2：开发工程师 → 产品经理

**输入（开发视角）：**
```
重构了前端构建流程，引入了代码分割和懒加载，首屏加载时间从 3 秒降到了 1.2 秒，Lighthouse 性能评分从 45 提升到 82。
```
**结果：**
## 🎯 业务价值核心
通过重构前端架构，让用户能"秒开"页面，显著提升使用流畅度，从而有效留住用户，提高用户留存率。

## 💬 给产品发的群消息
---
@产品
关于 **"前端性能优化"** 的最新进展/方案：
1.  **用户感知**：页面打开速度大幅提升，首屏加载时间从3秒缩短至1.2秒，用户再也不用盯着"白屏"或"转圈"等待了。
2.  **支持能力**：页面性能评分（Lighthouse）从45分提升至82分，为后续开展高流量运营活动（如大促、内容投放）提供了坚实的技术基础。
3.  **上线计划**：已完成开发与测试，计划本周内灰度上线，并准备了快速回滚方案。
4.  **配合建议**：建议产品侧关注上线后的用户留存率等核心指标变化，并同步评估对旧版本浏览器（如IE11）用户的兼容性影响。
---

## 📈 价值深度解析
- **用户路径影响**：优化直接作用于用户访问的**第一触点**。用户从点击链接到看到可交互页面的等待时间缩短了60%，极大地降低了因加载缓慢而导致的用户流失风险，让用户能更快地进入核心业务流程。
- **指标映射**：
    - **技术指标**：首屏加载时间从3s降至1.2s，Lighthouse评分从45提升至82。
    - **业务收益**：加载速度是影响用户留存的关键因素。速度提升直接转化为**用户留存率的提高**，意味着更多用户愿意留下来继续使用产品，为后续的转化和活跃奠定了基础。
- **风险与兼容性**：
    - **主要风险**：本次优化基于现代浏览器特性，可能导致**旧浏览器（如IE11）的兼容性下降**，部分老旧设备用户可能体验不佳或功能异常。
    - **若不做的后果**：如果不进行优化，页面加载缓慢将持续导致高跳出率和低留存率，在竞品体验更优的情况下，用户流失风险会不断累积。
    - **兼容逻辑**：方案已对主流现代浏览器（Chrome, Edge, Safari, Firefox最新版本）进行充分测试。对于旧版浏览器，我们保留了基础功能可用的降级方案。
- **商业影响**：
    - **稳定性红利**：更高的性能评分意味着页面更稳定、渲染更高效，能更好地支撑突发流量，为业务增长提供技术保障。
    - **未来扩展性**：新的构建架构为后续引入更复杂的交互功能、微前端等奠定了基础，技术债得到清理。
---
