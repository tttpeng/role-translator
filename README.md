# 职能沟通翻译助手 (Role Translator)

帮助产品经理和开发工程师更好地理解彼此的沟通翻译工具。

## 快速开始

### 1. 安装依赖

```bash
npm install
```

### 2. 配置环境变量

在项目根目录创建 `.env` 文件：

```
cp .env.example .env
```

```bash
# 必填：API 密钥
LLM_API_KEY=sk-xxxxxxxxxxxxxxxx

# 必填：API 基础地址
LLM_API_BASE_URL=https://api.openai.com/v1

# 选填：模型名称（默认 gpt-4o）
LLM_MODEL=gpt-4o
```

### 3. 运行项目

```bash
# 开发模式（热重载）
npm run dev

# 生产模式
npm start
```

打开浏览器访问 `http://localhost:3000`

---

## 项目结构

```text
role-translator/
├── public/                  # 前端静态资源
│   ├── index.html           # 主页面
│   └── app.js               # 前端逻辑
├── server/                  # 后端服务
│   ├── index.js             # Express 入口
│   ├── translators/         # 翻译器实现
│   │   ├── direct-translator.js      # 直出模式
│   │   └── interactive-translator.js # 交互模式
│   ├── prompts/             # 提示词库
│   │   └── prompts.js       # 核心 System Prompts
│   ├── middleware/          # Express 中间件
│   │   ├── sse.js           # SSE 流式响应
│   │   └── validation.js    # 请求验证
│   └── utils/               # 工具模块
│       ├── constants.js     # 常量定义
│       └── logger.js        # 日志工具
├── .env.example             # 环境变量示例
└── README.md
```

---

## 功能说明

### 这个工具做什么？

在企业协作中，产品经理关注用户价值和商业目标，开发工程师关注技术实现和工作量评估。这种视角差异经常导致沟通障碍。

本工具通过 AI 实现双向翻译：
- **产品 → 开发**：将模糊的业务需求转化为包含技术细节、边界条件、性能要求的技术语言
- **开发 → 产品**：将技术实现成果转化为体现业务价值、用户体验提升的业务语言

### 核心功能

1. **快速直出模式**：一步生成完整翻译结果，适合信息较完整的场景
2. **智能补齐模式**：AI 先识别缺失信息并提问，用户补充后再生成更准确的结果
3. **流式输出**：实时显示 AI 生成过程，体验更流畅
4. **一键复制**：生成的群消息可直接复制到 IM 工具中使用

## 产品截图
![应用截图](./screenshot.png)

## 测试用例

### 用例 1：产品经理 → 开发工程师

**输入（产品视角）：**
```
希望用户可以通过手机号一键登录，提升注册转化率。目前很多用户在注册页面流失，我们需要简化这个流程。
```
**结果：**

## 🚀 需求技术同步
实现基于运营商（移动/联通/电信）本机号码的一键认证功能，替代传统短信验证码，通过简化登录流程，技术核心在于安全、高效地集成运营商网关，以提升用户注册转化率。

## 💬 给开发发的群消息
---
@开发
关于“**手机号一键登录**”需求，核心逻辑如下：
1.  **意图**：集成三大运营商（移动/联通/电信）的本机号码认证服务，用户授权后，应用自动获取本机号码并完成登录/注册，无需手动输入验证码。
2.  **关键逻辑**：前端唤起运营商认证SDK -> 用户授权 -> 后端通过运营商网关换取手机号 -> 后端校验用户并创建/登录账户 -> 返回登录态。
3.  **技术关注点**：运营商网关接口的稳定性与安全调用、用户手机号与现有账户体系的匹配逻辑、认证失败后的降级方案（如回退短信验证码）。
4.  **验收标准**：
    *   功能：成功集成三家运营商SDK，用户可正常完成一键登录流程。
    *   性能：登录接口（含运营商网关调用）P99响应时间 < 2秒，支持QPS 100-1000。
    *   安全：传输过程加密，手机号等敏感信息脱敏存储，符合隐私合规要求。
    *   异常：网络超时、授权失败等场景有明确用户提示，并支持有限次重试。
---

## 🛠 技术视角解构
- **数据/埋点**：
    *   **关键事件**：`login_attempt`（登录尝试，触发一键登录）、`login_success`（登录成功）、`login_fail`（登录失败，需包含`fail_reason`，如：`operator_timeout`, `user_denied`）。
    *   **关键字段**：`login_type: one_click`、`operator: cmcc/cucc/ctcc`、`duration`（登录流程耗时）。
    *   **上报时机**：各事件在对应操作完成后立即上报。

- **逻辑边界**：
    *   **异常处理**：
        *   **运营商网关超时/失败**：设置超时时间（如3秒），失败后自动重试一次（仅限网络类错误）。若仍失败，可考虑前端降级展示“短信验证码登录”入口。
        *   **用户授权拒绝**：引导用户手动输入手机号或使用其他登录方式。
        *   **手机号与账户不匹配**：若系统根据手机号查找到多个账户或账户状态异常（如冻结），应中断自动登录，引导用户联系客服或使用密码登录。
        *   **频次与防刷**：对同一设备或IP的频繁登录失败请求进行限流（如1分钟5次）。
    *   **逆向流程**：用户在一键登录成功页，应提供“这不是我的手机号”或“切换账号”的退出入口，清除本次登录态，返回至登录方式选择页。

- **非功能性**：
    *   **性能**：针对QPS 100-1000的中等并发场景，后端调用运营商网关接口需考虑连接池、异步处理或结果缓存（运营商token有效期通常很短，约2分钟，缓存需谨慎）。
    *   **安全**：
        *   与运营商通信必须使用HTTPS。
        *   后端换取的手机号需进行脱敏处理后再写入业务日志。
        *   严格校验运营商返回的签名，防止伪造请求。
    *   **可用性**：因依赖外部运营商服务，需定义SLA（如99.5%），并设置监控告警（如接口成功率、平均耗时）。

- **技术方案建议**：
    *   **架构**：建议在后端设计一个统一的“认证网关”或“认证服务”，封装对三家运营商接口的差异，对外提供一致的`verifyToken(operator, clientToken)`方法。这有利于后续维护和增加其他认证方式。
    *   **选型**：前端集成各运营商官方SDK；后端语言根据现有技术栈选择（如Java/Go），需内置HTTP客户端、配置管理。

## ⏳ 粗估建议
- **复杂度**：**中等**
- **基准人天**：**8-12人天**。注：基于需同时集成三家运营商（联调复杂度较高）、设计统一的认证服务层、并完成完整的异常处理与降级逻辑的假设。若仅集成一家或复用现有简单验证码逻辑改造，复杂度可降低。

### 用例 2：开发工程师 → 产品经理

**输入（开发视角）：**
```
重构了前端构建流程，引入了代码分割和懒加载，首屏加载时间从 3 秒降到了 1.2 秒，Lighthouse 性能评分从 45 提升到 82。
```
**结果：**
## 🎯 业务价值核心
通过重构前端架构，让用户能“秒开”页面，显著提升使用流畅度，从而有效留住用户，提高用户留存率。

## 💬 给产品发的群消息
---
@产品
关于 **“前端性能优化”** 的最新进展/方案：
1.  **用户感知**：页面打开速度大幅提升，首屏加载时间从3秒缩短至1.2秒，用户再也不用盯着“白屏”或“转圈”等待了。
2.  **支持能力**：页面性能评分（Lighthouse）从45分提升至82分，为后续开展高流量运营活动（如大促、内容投放）提供了坚实的技术基础。
3.  **上线计划**：已完成开发与测试，计划本周内灰度上线，并准备了快速回滚方案。
4.  **配合建议**：建议产品侧关注上线后的用户留存率等核心指标变化，并同步评估对旧版本浏览器（如IE11）用户的兼容性影响。
---

## 📈 价值深度解析
- **用户路径影响**：优化直接作用于用户访问的**第一触点**。用户从点击链接到看到可交互页面的等待时间缩短了60%，极大地降低了因加载缓慢而导致的用户流失风险，让用户能更快地进入核心业务流程。
- **指标映射**：
    - **技术指标**：首屏加载时间从3s降至1.2s，Lighthouse评分从45提升至82。
    - **业务收益**：加载速度是影响用户留存的关键因素。速度提升直接转化为**用户留存率的提高**，意味着更多用户愿意留下来继续使用产品，为后续的转化和活跃奠定了基础。
- **风险与兼容性**：
    - **主要风险**：本次优化基于现代浏览器特性，可能导致**旧浏览器（如IE11）的兼容性下降**，部分老旧设备用户可能体验不佳或功能异常。
    - **若不做的后果**：如果不进行优化，页面加载缓慢将持续导致高跳出率和低留存率，在竞品体验更优的情况下，用户流失风险会不断累积。
    - **兼容逻辑**：方案已对主流现代浏览器（Chrome, Edge, Safari, Firefox最新版本）进行充分测试。对于旧版浏览器，我们保留了基础功能可用的降级方案。
- **商业影响**：
    - **稳定性红利**：更高的性能评分意味着页面更稳定、渲染更高效，能更好地支撑突发流量，为业务增长提供技术保障。
    - **未来扩展性**：新的构建架构为后续引入更复杂的交互功能、微前端等奠定了基础，技术债得到清理。
---

## 提示词设计说明

提示词设计的目标不是“把中文换一种说法”，而是实现**跨职能语义对齐**：把同一句话在“产品语言”和“技术语言”之间做**信息结构重构**，让输出能直接用于**业务决策（给产品）**或**技术评估与落地（给开发）**。因此整体采用 **「角色沉浸 + 结构化分析（Analysis）+ 合成生成（Synthesis）+ 默认假设兜底」** 的组合策略

---

### 一、如何让 AI 理解「产品视角」与「开发视角」的差异？

#### 1) 角色设定：先定岗，再输出
为了让模型一开始就进入对应的“工作脑”，针对两个方向分别给了明确、强约束的专家身份：

- **PM → Dev**：AI 扮演「资深技术架构师 / Tech Lead」  
  目标是把模糊需求拆成开发可评估、可落地的任务包，重点关注：**数据来源、异常边界、性能指标、外部依赖、验收口径、排期复杂度**。

- **Dev → PM**：AI 扮演「懂业务的技术负责人」  
  目标是把技术方案/成果翻译成产品可决策的信息，重点关注：**用户可感知变化、业务指标映射、商业收益空间、风险与上线策略、需要产品配合的事项**。

> 核心点：不让模型“自由发挥理解差异”，而是通过 System Prompt 的角色与任务定义，强制改变注意力分配与输出取舍。

---

#### 2) 关注点映射：把抽象词翻译成对方能用的“工作语言”
提示词里内置了语义转换的方向性：同样一句话，在不同角色语境下应该落到不同维度。

| 输入表达（常见口语） | PM → Dev（技术落地语言） | Dev → PM（业务可感知语言） |
|---|---|---|
| “快 / 稳” | QPS、Latency、SLA、错误率、降级策略 | 页面秒开、操作流畅、稳定不转圈 |
| “提升体验” | 缓存策略、接口优化、链路治理、埋点口径 | 满意度提升、留存/转化改善（合理假设） |
| “重构代码” | 技术债务、模块解耦、边界收敛、回归范围 | 迭代速度更快、维护成本下降、故障风险降低 |

> 核心点：把沟通从“主观表达”提升为“可对齐口径”，让对方能继续推进工作（评估 / 排期 / 决策）。

---

#### 3) 结构化输出：把对方的工作流写进答案里
为了让结果更接近真实协作产物，输出被强制成三层：

- **群消息片段**：短句、结论先行、行动点明确，可直接粘贴到 IM 群里  
- **深度解析**：对技术/业务做结构化拆解，支撑评审与排期  
- **默认假设**：信息不足时按行业标准补齐，而不是反复追问导致流程卡住

> 核心点：模板不是为了“好看”，而是为了让输出能直接进入下一步协作动作。

---

### 二、提示词里的关键设计点是什么？

为了保证输出的**稳定性**与**实用性**，关键机制被写进提示词与结构里，尽量减少发散与随机性。

#### 1) 「角色 + 任务 + 硬规则」三段式 System Prompt
- **Role**：明确扮演谁（Tech Lead / 懂业务的技术负责人）  
- **Task**：明确要把输入重构成对方可用的语言（可评估 / 可决策）  
- **Rules**：明确不可违背的约束。

> 价值点：让模型输出从“解释型回答”变成“交付型产物”。

---

#### 2) 两阶段架构（Analysis → Synthesis）：先识别缺口，再生成结果
翻译任务被拆成两步，避免一上来就生成“看似完整但不可用”的长文：

- **Analysis（分析缺口）**：通过 `ANALYSIS_JSON_SCHEMA_BASE` 强制输出严格 JSON  
  目的不是格式化，而是强迫模型先结构化思考：提炼 `logic_core`，列出 `missing_info`（最多 3 个且按阻塞优先级排序），并给出 `confidence_score` / `can_proceed_directly`。

- **Synthesis（合成回复）**：在缺口与假设清晰后，再按输出结构生成最终的“对方语言”。

> 价值点：把不确定性收敛成可控中间态，输出更稳，也更方便工程侧做流程编排（是否需要补充信息、是否可直接生成）。

---

#### 3) 默认假设兜底：拒绝留白，保证能推进
现实里用户经常补不齐细节，如果 AI 一直追问，体验会很差。为了解决这个问题：

- 在 JSON Schema 中设置 `default_assumption` 字段，要求每个缺口给出一个行业基线  
- 在 Synthesis 阶段明确硬规则：  
  - **事实来源优先级**：用户回答 > 默认假设 > 原始输入  
  - **拒绝留白**：用户不答就直接采用默认假设，不再追问

> 价值点：即使输入很简短，也能基于 Best Practices 产出可用内容，并且把“基于哪些假设推导”说清楚，方便后续对齐与修正。

---

#### 4) IM 友好的场景化输出：让结果能直接发群
相比生成长篇报告，更高频的使用场景其实是“发一段能推动协作的群消息”。因此输出结构里固定了：

- “一句话核心”先把结论讲清楚  
- “@开发 / @产品”的群消息格式，条列关键点，强调可执行性  
- 同时保留“深度解析”，兼顾快速同步与深入评审

> 价值点：输出天然就是沟通素材，可直接复制粘贴，落地感更强。